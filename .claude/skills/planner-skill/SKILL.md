---
name: planner-skill
description: 规划与归档技能包。负责全书大纲构建、人物设计、世界观建立、逐章场景规划，以及章节定稿后的bible维护更新。是故事结构信息的唯一管理者。
---

# 规划与归档技能包

[技能说明]
    planner是故事结构信息的唯一管理者，覆盖两类工作：

    规划（创造结构）：
    - 构建全书大纲
    - 设计人物设定
    - 建立世界观框架
    - 逐章场景规划

    归档（维护结构）：
    - 章节定稿后更新bible
    - 维护悬念和伏笔追踪
    - 人物状态同步
    - bible一致性检查

    planner是bible的唯一写入者。
    其他角色可以读取bible，但不能修改。

[文件结构]
    planner-skill/
    ├── SKILL.md                    # 本文件
    ├── archive-maintenance.md      # 归档维护规范（格式标准和更新规则）
    └── templates/
        ├── outline-template.md     # 大纲模板
        └── character-template.md   # 人物档案模板

    规划时参考的共享技能：
    - shared/hook-techniques.md（悬念和伏笔布局）

    管理的目标目录：
    bible/
    ├── characters/            # 人物档案
    │   ├── [角色名].md
    │   └── relationships.md   # 人物关系总览
    ├── worldbuilding/         # 世界观设定
    ├── plot/                  # 情节记录
    │   ├── outline.md         # 大纲（含TODO和章节摘要）
    │   ├── suspense-tracker.md
    │   └── foreshadow-tracker.md
    └── changelog.md           # 更新日志

# ============================================================
# 第一部分：规划功能
# ============================================================

[功能一：构建大纲]
    当主Agent启动新项目时执行。

    第一步：收集信息
        从用户提供的素材中提取：
        - 故事类型和题材
        - 核心概念或灵感来源
        - 期望的风格和调性
        - 目标读者群体
        - 预期篇幅（章节数和总字数）

    第二步：构建大纲
        按 templates/outline-template.md 的格式，产出：
        - 基本信息（题材、章节数、字数目标、核心冲突）
        - 章节规划表（每章的标题、核心事件、悬念钩子）
        - 全书悬念线（主线悬念、支线悬念、终极揭秘）
        - TODO清单（初始状态全部为"待创作"）

    第三步：确认与写入
        交给主Agent确认后，写入 bible/plot/outline.md。
        同时初始化：
        - bible/plot/suspense-tracker.md
        - bible/plot/foreshadow-tracker.md
        - bible/changelog.md

[功能二：设计人物]
    在大纲确认后执行。

    第一步：确定角色阵容
        根据大纲中的核心冲突和章节规划，确定：
        - 主角（一到两个）
        - 反派/对手（一到两个）
        - 关键配角（根据故事需要）
        - 每个角色在故事中的功能

    第二步：填充角色设定
        按 templates/character-template.md 的格式，
        为每个角色设计完整或精简档案。

        主角和反派使用完整模板：
        - 基本信息、性格核心（渴望/恐惧/缺陷）
        - 语言指纹、背景故事、角色弧线

        配角使用精简模板：
        - 基本信息、核心特质、故事功能

    第三步：设计人物关系网
        产出 relationships.md：
        - 所有重要角色之间的关系
        - 关系的初始状态

    第四步：确认与写入
        交给主Agent确认后，写入 bible/characters/

[功能三：建立世界观]
    如果故事需要世界观建设，在大纲确认后执行。

    产出内容（根据项目需要选择）：
    - 地理/地点设定
    - 世界规则（魔法体系、科技水平、社会结构等）
    - 组织/势力
    - 时间线（故事开始前的重要历史事件）

    格式参考 archive-maintenance.md 中的世界观文件格式。
    交给主Agent确认后，写入 bible/worldbuilding/

[功能四：章节场景规划]
    在每章写作开始前执行。

    第一步：读取上下文
        - bible/plot/outline.md 中该章的大纲描述
        - 前一章的正文（特别是结尾段落）
        - 相关人物档案的当前状态
        - bible/plot/suspense-tracker.md（活跃悬念）
        - bible/plot/foreshadow-tracker.md（活跃伏笔）

    第二步：设计场景序列
        将本章拆分为2-4个场景，每个场景包含：
        - 场景编号和标题
        - POV（视角角色）
        - 场景目标（叙事任务）
        - 核心事件
        - 参与角色
        - 情感基调
        - 冲突/张力来源
        - 信息流（读者和角色分别获得什么新信息）

    第三步：悬念和伏笔规划
        参考 shared/hook-techniques.md：
        - 本章应回应哪些旧悬念
        - 本章应提出哪些新悬念
        - 本章应埋设哪些伏笔
        - 章末钩子类型和大致方向

    第四步：节奏规划
        - 开头：切入方式和吸引力设计
        - 中段：场景间的节奏变化
        - 结尾：收束方式

    第五步：字数分配
        根据场景数量和重要性，建议各场景的大致字数。
        总字数目标：3000-5000字。

    第六步：输出
        写入 plans/chNN-plan.md

    [场景规划模板]

        # 第[N]章 场景规划

        [章节信息]
            章节编号：chNN
            大纲描述：[从outline.md中引用]
            衔接上章：[上章结尾的状态和悬念]
            本章目标：[本章要完成的核心叙事任务]
            字数目标：[XXXX字]

        [场景序列]

            [场景1]
                标题：
                POV：
                场景目标：
                核心事件：
                参与角色：
                情感基调：
                冲突/张力来源：
                信息流：
                建议字数：

            [场景2]
                ...

        [悬念与伏笔]
            回应旧悬念：[列出要回应的悬念及回应方式]
            新增悬念：[列出要提出的新悬念]
            埋设伏笔：[列出要埋的伏笔及形式]
            章末钩子：[建议使用的钩子类型和大致方向]

        [节奏设计]
            开头：[切入方式]
            中段节奏：[场景间的节奏变化]
            结尾：[收束方式]

        [备注]
            [需要writer特别注意的事项]

# ============================================================
# 第二部分：归档功能
# ============================================================

[功能五：章节定稿后更新]
    当章节通过审查并完成润色后触发。

    第一步：读取输入
        - 定稿的章节正文
        - 审查报告（特别是连贯性备注部分）
        - 该章的场景规划

    第二步：识别变化
        从定稿章节和审查报告中提取：

        人物变化：
        - 位置、情绪、关系、能力/信息、外貌、身体状态
        - 本章的关键行为

        世界观变化：
        - 新地点、新设定、新组织

        情节记录：
        - 本章摘要（两到三句话）
        - 新增悬念、已回收悬念
        - 新增伏笔、已回收伏笔

    第三步：执行更新
        按 archive-maintenance.md 的格式规范更新各文件。
        只修改有变化的字段，其他内容不动。

    第四步：更新大纲状态
        在 outline.md 中：
        - 将本章从"进行中"移至"已完成"，标注字数
        - 将下一章移至"待创作"或保持不变
        - 追加本章的章节摘要

    第五步：更新日志
        在 bible/changelog.md 中记录：
        - 触发章节
        - 更新了哪些文件
        - 每个文件改了什么

    第六步：返回确认
        向主Agent确认更新完成，列出更新的文件清单。

[功能六：一致性检查]
    当主Agent要求时执行，或每隔五章自动建议执行一次。

    检查内容：
    - 人物档案之间是否有矛盾
    - 世界观设定是否有自相矛盾
    - 悬念追踪中是否有超期未回收的悬念
    - 伏笔追踪中是否有超过预期回收位置仍未回收的伏笔
    - 人物当前状态是否与最近章节一致
    - 大纲中的TODO状态是否与实际进度一致

    产出一致性检查报告，标注具体问题和建议修正方向。

# ============================================================
# 第三部分：通用原则
# ============================================================

[规划原则]
    - 场景规划是蓝图不是剧本，writer可以调整细节
    - 每章建议2-4个场景，避免每个场景太薄
    - 场景之间应有节奏变化
    - 悬念和伏笔的规划应参考追踪器，避免遗忘或重复
    - 规划应基于bible中的已有事实

[归档原则]
    - 只记录已经发生的事实，不预测未来章节
    - 只更新有变化的字段
    - 保持格式一致，参考 archive-maintenance.md
    - 每次更新都写日志
    - 如果章节内容与现有bible有矛盾，
      以定稿章节为准更新bible，在日志中标注

[注意事项]
    - planner不写正文，不做语言润色
    - 如果规划过程中发现大纲需要调整，
      向主Agent提出建议，经确认后再修改
    - 人物设定和世界观的初始建立需要主Agent确认后才写入bible
    - 稳定字段（性格核心、背景等）一般不因单章事件修改，
      除非发生重大转变，且需在日志中说明原因
